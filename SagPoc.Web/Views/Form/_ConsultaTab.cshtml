@model SagPoc.Web.Models.FormRenderViewModel

<div class="consulta-container" id="consultaContainer" data-table-id="@Model.Form.TableId">
    <!-- Toolbar unificado -->
    <div class="consulta-toolbar d-flex justify-content-between align-items-center mb-2">
        <!-- Lado esquerdo: Select + Filtros + Refresh -->
        <div class="d-flex align-items-center gap-2">
            <select id="consultaSelect" class="form-select form-select-sm" style="width: 220px;">
                @foreach (var consulta in Model.Consultas)
                {
                    <option value="@consulta.CodiCons" data-busc="@consulta.BuscCons">
                        @consulta.BuscCons
                    </option>
                }
            </select>
            <button type="button" class="btn btn-outline-secondary btn-sm"
                    data-bs-toggle="collapse" data-bs-target="#filterCollapse"
                    aria-expanded="false" aria-controls="filterCollapse"
                    id="btnToggleFilters" title="Mostrar/ocultar filtros">
                <i class="bi bi-funnel"></i>
                <span id="filterBadge" class="badge bg-primary ms-1" style="display:none;">0</span>
            </button>
            <button type="button" class="btn btn-outline-secondary btn-sm" id="btnRefresh" title="Atualizar">
                <i class="bi bi-arrow-clockwise"></i>
            </button>
        </div>

        <!-- Lado direito: CRUD buttons -->
        <div class="d-flex gap-2">
            @if (Model.ShowBtnIncluir)
            {
                <button type="button" class="btn btn-success btn-sm" id="btnIncluir">
                    <i class="bi bi-plus-lg"></i> Incluir
                </button>
            }
            @if (Model.ShowBtnAlterar)
            {
                <button type="button" class="btn btn-primary btn-sm" id="btnAlterar" disabled>
                    <i class="bi bi-pencil"></i> Alterar
                </button>
            }
            @if (Model.ShowBtnExcluir)
            {
                <button type="button" class="btn btn-danger btn-sm" id="btnExcluir" disabled>
                    <i class="bi bi-trash"></i> Excluir
                </button>
            }
        </div>
    </div>

    <!-- Filtros colapsaveis (default: fechado) -->
    <div class="collapse" id="filterCollapse">
        <div class="card card-body py-2 mb-2">
            <div class="row g-2 align-items-center" id="filterRow">
                <div class="col-md-3">
                    <select id="filterField" class="form-select form-select-sm">
                        <option value="">-- Campo --</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <select id="filterCondition" class="form-select form-select-sm">
                        <option value="startswith">Iniciado por</option>
                        <option value="contains" selected>Cont√©m</option>
                        <option value="equals">Igual a</option>
                        <option value="notequals">Diferente de</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <input type="text" id="filterValue" class="form-control form-control-sm" placeholder="Localiza...">
                </div>
                <div class="col-md-4 d-flex gap-2">
                    <button type="button" class="btn btn-primary btn-sm" id="btnAddFilter">
                        <i class="bi bi-funnel"></i> Filtrar
                    </button>
                    <button type="button" class="btn btn-outline-secondary btn-sm" id="btnClearFilters">
                        <i class="bi bi-x-circle"></i> Limpar
                    </button>
                </div>
            </div>
            <!-- Tags de filtros ativos -->
            <div id="activeFilters" class="mt-2"></div>
        </div>
    </div>

    <!-- AG Grid Container -->
    <div id="consultaAgGrid" class="ag-theme-quartz"></div>
</div>
