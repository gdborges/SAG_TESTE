@model SagPoc.Web.Models.FormRenderViewModel

<div class="consulta-container" id="consultaContainer"
     data-table-id="@Model.Form.TableId"
     data-show-edit="@Model.ShowBtnAlterar.ToString().ToLower()"
     data-show-delete="@Model.ShowBtnExcluir.ToString().ToLower()">
    <!-- Toolbar unificado -->
    <div class="consulta-toolbar d-flex justify-content-between align-items-center mb-2">
        <!-- Lado esquerdo: Select + Filtros + Refresh -->
        <div class="d-flex align-items-center gap-2">
            <select id="consultaSelect" class="form-select form-select-sm" style="width: 220px;">
                @foreach (var consulta in Model.Consultas)
                {
                    <option value="@consulta.CodiCons" data-busc="@consulta.BuscCons">
                        @consulta.BuscCons
                    </option>
                }
            </select>
            <button type="button" class="btn btn-outline-secondary btn-sm d-inline-flex align-items-center justify-content-center"
                    data-bs-toggle="collapse" data-bs-target="#filterCollapse"
                    aria-expanded="false" aria-controls="filterCollapse"
                    id="btnToggleFilters" title="Mostrar/ocultar filtros">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M7 12h10"/><path d="M10 18h4"/></svg>
                <span id="filterBadge" class="badge bg-primary ms-1" style="display:none;">0</span>
            </button>
            <button type="button" class="btn btn-outline-secondary btn-sm d-inline-flex align-items-center justify-content-center" id="btnRefresh" title="Atualizar">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>
            </button>
        </div>

        <!-- Lado direito: Botão Adicionar (padrão Edata/Vision) -->
        <div class="d-flex gap-2">
            @if (Model.ShowBtnIncluir)
            {
                <button type="button" class="grid-add-button" id="btnIncluir">
                    <i class="bi bi-plus-lg"></i> Adicionar
                </button>
            }
            @* Botões Alterar e Excluir removidos - agora são inline no grid (coluna Ações) *@
        </div>
    </div>

    <!-- Filtros colapsaveis (default: fechado) -->
    <div class="collapse" id="filterCollapse">
        <div class="card card-body py-2 mb-2">
            <div class="row g-2 align-items-center" id="filterRow">
                <div class="col-md-3">
                    <select id="filterField" class="form-select form-select-sm">
                        <option value="">-- Campo --</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <select id="filterCondition" class="form-select form-select-sm">
                        <option value="startswith">Iniciado por</option>
                        <option value="contains" selected>Contém</option>
                        <option value="equals">Igual a</option>
                        <option value="notequals">Diferente de</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <input type="text" id="filterValue" class="form-control form-control-sm" placeholder="Localiza...">
                </div>
                <div class="col-md-4 d-flex gap-2">
                    <button type="button" class="btn btn-primary btn-sm" id="btnAddFilter">
                        <i class="bi bi-funnel"></i> Filtrar
                    </button>
                    <button type="button" class="btn btn-outline-secondary btn-sm" id="btnClearFilters">
                        <i class="bi bi-x-circle"></i> Limpar
                    </button>
                </div>
            </div>
            <!-- Tags de filtros ativos -->
            <div id="activeFilters" class="mt-2"></div>
        </div>
    </div>

    <!-- AG Grid Container -->
    <div id="consultaAgGrid" class="ag-theme-quartz"></div>
</div>
