@model object
@using SagPoc.Web.Models

@{
    // Suporta FieldRenderContext (novo) ou FieldMetadata (compatibilidade)
    FieldMetadata field;
    bool isSingleInRow = false;

    if (Model is FieldRenderContext ctx)
    {
        field = ctx.Field;
        isSingleInRow = ctx.IsSingleInRow;
    }
    else if (Model is FieldMetadata fm)
    {
        field = fm;
        isSingleInRow = false; // fallback: nao aplica max-width
    }
    else
    {
        throw new InvalidOperationException("Model deve ser FieldRenderContext ou FieldMetadata");
    }

    // Campos ocultos não são renderizados
    if (field.IsHidden)
    {
        return;
    }

    var componentType = field.GetComponentType();
    var fieldId = $"field_{field.CodiCamp}";
    var fieldName = field.NomeCamp;
    var label = field.LabeCamp;
    var hasLabel = !string.IsNullOrEmpty(label);
    var isRequired = field.IsRequired;
    var isDisabled = field.IsDisabled || field.IsReadonly;
    var hint = field.HintCamp;

    // Estilo baseado em TamaCamp
    // - Campo único na linha: flex grow para usar espaço disponível
    // - Múltiplos campos: flex-grow proporcional ao TamaCamp
    // - Checkboxes/botões: tamanho fixo, não crescem
    var wrapperStyle = "";
    if (field.TamaCamp > 0)
    {
        var isFixedWidth = componentType == ComponentType.Checkbox
                        || componentType == ComponentType.CalcCheckbox
                        || componentType == ComponentType.Button;

        if (isSingleInRow)
        {
            // Campo único: permitir crescer para usar espaço disponível
            wrapperStyle = $"flex: 1 1 {field.TamaCamp}px;";
        }
        else if (isFixedWidth)
        {
            // Checkboxes/botões: não crescer, manter compactos
            wrapperStyle = $"flex: 0 0 auto;";
        }
        else
        {
            // Multi-campo: crescer proporcionalmente ao TamaCamp original
            wrapperStyle = $"flex: {field.TamaCamp} 1 {field.TamaCamp}px; min-width: {Math.Min(field.TamaCamp, 120)}px;";
        }
    }

    // Classe adicional para campos readonly
    var readonlyClass = field.IsReadonly ? "field-readonly" : "";

    // Atributos data-sag-* para sistema de eventos PLSAG
    var sagCodicamp = field.CodiCamp.ToString();
    var sagNomecamp = field.NomeCamp;  // Nome do campo no banco (para name attribute e persistência)
    var sagNamecamp = field.NameCamp;  // Nome do componente visual (usado pelo PLSAG para FindComponent)
    var sagComptype = field.CompCamp?.ToUpper()?.Trim() ?? "E";
}

@switch (componentType)
{
    // ============================================================
    // TIPOS BÁSICOS (DB-Aware)
    // ============================================================

    case ComponentType.TextInput:
        // E - Input de texto
        <div class="field-wrapper @readonlyClass" style="@wrapperStyle">
            @if (hasLabel)
            {
                <label for="@fieldId" class="form-label">
                    @label
                    @if (isRequired)
                    {
                        <span class="text-danger">*</span>
                    }
                </label>
            }
            <input type="text"
                   class="form-control"
                   id="@fieldId"
                   name="@fieldName"
                   title="@hint"
                   placeholder="@hint"
                   @(isRequired ? "required" : "")
                   @(isDisabled ? "disabled" : "")
                   data-mask="@field.MascCamp"
                   data-sag-codicamp="@sagCodicamp"
                   data-sag-nomecamp="@sagNomecamp"
                   data-sag-namecamp="@sagNamecamp"
                   data-sag-comptype="@sagComptype" />
        </div>
        break;

    case ComponentType.NumberInput:
        // N - Input numerico
        <div class="field-wrapper @readonlyClass" style="@wrapperStyle">
            @if (hasLabel)
            {
                <label for="@fieldId" class="form-label">
                    @label
                    @if (isRequired)
                    {
                        <span class="text-danger">*</span>
                    }
                </label>
            }
            <input type="number"
                   class="form-control"
                   id="@fieldId"
                   name="@fieldName"
                   title="@hint"
                   placeholder="@hint"
                   @if (field.MiniCamp.HasValue && field.MiniCamp.Value != 0) { <text>min="@field.MiniCamp.Value"</text> }
                   @if (field.MaxiCamp.HasValue && field.MaxiCamp.Value != 0) { <text>max="@field.MaxiCamp.Value"</text> }
                   step="any"
                   data-decimals="@field.DeciCamp"
                   @(isRequired ? "required" : "")
                   @(isDisabled ? "disabled" : "")
                   data-sag-codicamp="@sagCodicamp"
                   data-sag-nomecamp="@sagNomecamp"
                   data-sag-namecamp="@sagNamecamp"
                   data-sag-comptype="@sagComptype" />
        </div>
        break;

    case ComponentType.DateInput:
        // D - Input de data
        <div class="field-wrapper @readonlyClass" style="@wrapperStyle">
            @if (hasLabel)
            {
                <label for="@fieldId" class="form-label">
                    @label
                    @if (isRequired)
                    {
                        <span class="text-danger">*</span>
                    }
                </label>
            }
            <input type="date"
                   class="form-control"
                   id="@fieldId"
                   name="@fieldName"
                   title="@hint"
                   @(isRequired ? "required" : "")
                   @(isDisabled ? "disabled" : "")
                   data-sag-codicamp="@sagCodicamp"
                   data-sag-nomecamp="@sagNomecamp"
                   data-sag-namecamp="@sagNamecamp"
                   data-sag-comptype="@sagComptype" />
        </div>
        break;

    case ComponentType.Checkbox:
        // S - Checkbox
        var isCheckedByDefault = field.PadrCamp.HasValue && field.PadrCamp.Value == 1;
        <div class="field-wrapper @readonlyClass" style="@wrapperStyle">
            <div class="form-check">
                <input type="hidden" name="@fieldName" value="0" />
                <input type="checkbox"
                       class="form-check-input"
                       id="@fieldId"
                       name="@fieldName"
                       value="1"
                       title="@hint"
                       @(isCheckedByDefault ? "checked" : "")
                       @(isDisabled ? "disabled" : "")
                       data-sag-codicamp="@sagCodicamp"
                       data-sag-nomecamp="@sagNomecamp"
                   data-sag-namecamp="@sagNamecamp"
                       data-sag-comptype="@sagComptype" />
                @if (hasLabel)
                {
                    <label for="@fieldId" class="form-check-label">
                        @label
                    </label>
                }
            </div>
        </div>
        break;

    case ComponentType.ComboBox:
        // C - ComboBox com valores fixos (VareCamp)
        <div class="field-wrapper @readonlyClass" style="@wrapperStyle">
            @if (hasLabel)
            {
                <label for="@fieldId" class="form-label">
                    @label
                    @if (isRequired)
                    {
                        <span class="text-danger">*</span>
                    }
                </label>
            }
            <select class="form-select"
                    id="@fieldId"
                    name="@fieldName"
                    title="@hint"
                    @(isRequired ? "required" : "")
                    @(isDisabled ? "disabled" : "")
                    data-sag-codicamp="@sagCodicamp"
                    data-sag-nomecamp="@sagNomecamp"
                   data-sag-namecamp="@sagNamecamp"
                    data-sag-comptype="@sagComptype">
                <option value="">Selecione...</option>
                @if (!string.IsNullOrEmpty(field.VareCamp))
                {
                    var displayOptions = field.VareCamp.Split(new[] { '|', '\n', '\r' }, StringSplitOptions.RemoveEmptyEntries);
                    var valueOptions = !string.IsNullOrEmpty(field.VaGrCamp)
                        ? field.VaGrCamp.Split(new[] { '|', '\n', '\r' }, StringSplitOptions.RemoveEmptyEntries)
                        : null;

                    for (var i = 0; i < displayOptions.Length; i++)
                    {
                        var displayText = displayOptions[i].Trim();
                        // Se VaGrCamp tem valor no mesmo índice, usa como value; senão usa o texto
                        var optValue = (valueOptions != null && i < valueOptions.Length)
                            ? valueOptions[i].Trim()
                            : displayText;
                        <option value="@optValue">@displayText</option>
                    }
                }
            </select>
        </div>
        break;

    case ComponentType.LookupCombo:
    case ComponentType.LookupComboInfo:
        // T, IT - LookupCombo com SQL_CAMP
        var isInfoLookup = componentType == ComponentType.LookupComboInfo;
        <div class="field-wrapper @readonlyClass @(isInfoLookup ? "field-info" : "")" style="@wrapperStyle">
            @if (hasLabel)
            {
                <label for="@fieldId" class="form-label">
                    @label
                    @if (isRequired)
                    {
                        <span class="text-danger">*</span>
                    }
                </label>
            }
            @{
                var hasLookupSqlCombo = !string.IsNullOrEmpty(field.SqlCamp);
            }
            <select class="form-select @(isInfoLookup ? "form-select-info" : "")"
                    id="@fieldId"
                    name="@fieldName"
                    title="@hint"
                    @(isRequired ? "required" : "")
                    @(isDisabled || isInfoLookup ? "disabled" : "")
                    data-sag-codicamp="@sagCodicamp"
                    data-sag-nomecamp="@sagNomecamp"
                    data-sag-namecamp="@sagNamecamp"
                    data-sag-comptype="@sagComptype"
                    data-has-duplcliq="true"
                    data-codi-camp="@field.CodiCamp"
                    data-codi-tabe="@field.CodiTabe"
                    @if (hasLookupSqlCombo) {
                        <text>data-lookup-sql="@field.SqlCamp"</text>
                    }
                    @if (field.SqlLines != null && field.SqlLines.Length > 0) {
                        <text>data-sql-lines='@System.Text.Json.JsonSerializer.Serialize(field.SqlLines)'</text>
                    }>
                <option value="">Selecione...</option>
                @if (field.LookupOptions != null && field.LookupOptions.Count > 0)
                {
                    foreach (var opt in field.LookupOptions)
                    {
                        <option value="@opt.Key">@opt.Value</option>
                    }
                }
                else if (!string.IsNullOrEmpty(field.VareCamp))
                {
                    var fbDisplayOptions = field.VareCamp.Split(new[] { '|', '\n', '\r' }, StringSplitOptions.RemoveEmptyEntries);
                    var fbValueOptions = !string.IsNullOrEmpty(field.VaGrCamp)
                        ? field.VaGrCamp.Split(new[] { '|', '\n', '\r' }, StringSplitOptions.RemoveEmptyEntries)
                        : null;

                    for (var i = 0; i < fbDisplayOptions.Length; i++)
                    {
                        var displayText = fbDisplayOptions[i].Trim();
                        // Se VaGrCamp tem valor no mesmo índice, usa como value; senão usa o texto
                        var optValue = (fbValueOptions != null && i < fbValueOptions.Length)
                            ? fbValueOptions[i].Trim()
                            : displayText;
                        <option value="@optValue">@displayText</option>
                    }
                }
            </select>
        </div>
        break;

    case ComponentType.LookupModal:
    case ComponentType.LookupModalInfo:
        // L, IL - Lookup modal (botão de pesquisa ao lado) + campo descrição automático
        // Similar ao TDBLookNume do Delphi que mostra descrição ao lado do código
        var isInfoModal = componentType == ComponentType.LookupModalInfo;
        var lookupDescId = $"{fieldId}_desc";
        var hasLookupSql = !string.IsNullOrEmpty(field.SqlCamp);
        <div class="field-wrapper field-lookup-container @readonlyClass @(isInfoModal ? "field-info" : "")" style="@wrapperStyle">
            @if (hasLabel)
            {
                <label for="@fieldId" class="form-label">
                    @label
                    @if (isRequired)
                    {
                        <span class="text-danger">*</span>
                    }
                </label>
            }
            <div class="lookup-inputs-row">
                <div class="input-group lookup-code-group">
                    <input type="text"
                           class="form-control @(isInfoModal ? "form-control-info" : "") lookup-code-input"
                           id="@fieldId"
                           name="@fieldName"
                           title="@hint"
                           placeholder="@hint"
                           @(isRequired ? "required" : "")
                           @(isDisabled || isInfoModal ? "readonly" : "")
                           data-sag-codicamp="@sagCodicamp"
                           data-sag-nomecamp="@sagNomecamp"
                           data-sag-namecamp="@sagNamecamp"
                           data-sag-comptype="@sagComptype"
                           data-lookup-desc-id="@lookupDescId"
                           data-has-duplcliq="true"
                           data-codi-camp="@field.CodiCamp"
                           data-codi-tabe="@field.CodiTabe"
                           @if (hasLookupSql) {
                               <text>data-lookup-sql="@field.SqlCamp"</text>
                           }
                           @if (field.SqlLines != null && field.SqlLines.Length > 0) {
                               <text>data-sql-lines='@System.Text.Json.JsonSerializer.Serialize(field.SqlLines)'</text>
                           } />
                    <button type="button"
                            class="btn btn-outline-secondary btn-lookup"
                            title="Pesquisar"
                            @(isDisabled ? "disabled" : "")>
                        <i class="bi bi-search"></i>
                    </button>
                </div>
                @* Campo de descrição automática - similar ao TDBLookNume do Delphi *@
                <input type="text"
                       class="form-control lookup-desc-field"
                       id="@lookupDescId"
                       readonly
                       tabindex="-1"
                       placeholder="(descrição)"
                       data-lookup-for="@fieldId" />
            </div>
        </div>
        break;

    case ComponentType.TextArea:
    case ComponentType.TextAreaBlob:
        // M, BM - TextArea/Memo
        var textareaRows = field.AltuCamp > 50 ? field.AltuCamp / 25 : 3;
        <div class="field-wrapper field-wrapper-full mb-3 @readonlyClass">
            @if (hasLabel)
            {
                <label for="@fieldId" class="form-label">
                    @label
                    @if (isRequired)
                    {
                        <span class="text-danger">*</span>
                    }
                </label>
            }
            <textarea class="form-control"
                      id="@fieldId"
                      name="@fieldName"
                      title="@hint"
                      placeholder="@hint"
                      rows="@textareaRows"
                      @(isRequired ? "required" : "")
                      @(isDisabled ? "disabled" : "")
                      data-sag-codicamp="@sagCodicamp"
                      data-sag-nomecamp="@sagNomecamp"
                   data-sag-namecamp="@sagNamecamp"
                      data-sag-comptype="@sagComptype"></textarea>
        </div>
        break;

    case ComponentType.FileInput:
        // A - Upload de arquivo
        <div class="field-wrapper @readonlyClass" style="@wrapperStyle">
            @if (hasLabel)
            {
                <label for="@fieldId" class="form-label">
                    @label
                    @if (isRequired)
                    {
                        <span class="text-danger">*</span>
                    }
                </label>
            }
            <input type="file"
                   class="form-control"
                   id="@fieldId"
                   name="@fieldName"
                   title="@hint"
                   @(isRequired ? "required" : "")
                   @(isDisabled ? "disabled" : "")
                   data-sag-codicamp="@sagCodicamp"
                   data-sag-nomecamp="@sagNomecamp"
                   data-sag-namecamp="@sagNamecamp"
                   data-sag-comptype="@sagComptype" />
        </div>
        break;

    // ============================================================
    // TIPOS CALCULADOS (não-DB)
    // ============================================================

    case ComponentType.CalcTextInput:
        // EE - Editor texto calculado editável
        <div class="field-wrapper field-calc" style="@wrapperStyle">
            @if (hasLabel)
            {
                <label for="@fieldId" class="form-label">
                    @label
                </label>
            }
            <input type="text"
                   class="form-control form-control-calc"
                   id="@fieldId"
                   name="@fieldName"
                   title="@hint"
                   placeholder="@hint"
                   @(isDisabled ? "disabled" : "")
                   data-calc="true"
                   data-sag-codicamp="@sagCodicamp"
                   data-sag-nomecamp="@sagNomecamp"
                   data-sag-namecamp="@sagNamecamp"
                   data-sag-comptype="@sagComptype" />
        </div>
        break;

    case ComponentType.CalcTextReadonly:
        // LE - Editor texto calculado readonly
        <div class="field-wrapper field-calc field-readonly" style="@wrapperStyle">
            @if (hasLabel)
            {
                <label for="@fieldId" class="form-label">
                    @label
                </label>
            }
            <input type="text"
                   class="form-control form-control-calc"
                   id="@fieldId"
                   name="@fieldName"
                   title="@hint"
                   readonly
                   data-calc="true"
                   data-sag-codicamp="@sagCodicamp"
                   data-sag-nomecamp="@sagNomecamp"
                   data-sag-namecamp="@sagNamecamp"
                   data-sag-comptype="@sagComptype" />
        </div>
        break;

    case ComponentType.CalcNumberInput:
        // EN - Número calculado editável
        <div class="field-wrapper field-calc" style="@wrapperStyle">
            @if (hasLabel)
            {
                <label for="@fieldId" class="form-label">
                    @label
                </label>
            }
            <input type="number"
                   class="form-control form-control-calc"
                   id="@fieldId"
                   name="@fieldName"
                   title="@hint"
                   placeholder="@hint"
                   @if (field.MiniCamp.HasValue && field.MiniCamp.Value != 0) { <text>min="@field.MiniCamp.Value"</text> }
                   @if (field.MaxiCamp.HasValue && field.MaxiCamp.Value != 0) { <text>max="@field.MaxiCamp.Value"</text> }
                   step="any"
                   data-decimals="@field.DeciCamp"
                   @(isDisabled ? "disabled" : "")
                   data-calc="true"
                   data-sag-codicamp="@sagCodicamp"
                   data-sag-nomecamp="@sagNomecamp"
                   data-sag-namecamp="@sagNamecamp"
                   data-sag-comptype="@sagComptype" />
        </div>
        break;

    case ComponentType.CalcNumberReadonly:
        // LN - Número calculado readonly
        <div class="field-wrapper field-calc field-readonly" style="@wrapperStyle">
            @if (hasLabel)
            {
                <label for="@fieldId" class="form-label">
                    @label
                </label>
            }
            <input type="number"
                   class="form-control form-control-calc"
                   id="@fieldId"
                   name="@fieldName"
                   title="@hint"
                   @if (field.MiniCamp.HasValue && field.MiniCamp.Value != 0) { <text>min="@field.MiniCamp.Value"</text> }
                   @if (field.MaxiCamp.HasValue && field.MaxiCamp.Value != 0) { <text>max="@field.MaxiCamp.Value"</text> }
                   readonly
                   data-calc="true"
                   data-sag-codicamp="@sagCodicamp"
                   data-sag-nomecamp="@sagNomecamp"
                   data-sag-namecamp="@sagNamecamp"
                   data-sag-comptype="@sagComptype" />
        </div>
        break;

    case ComponentType.CalcDateInput:
        // ED - Data calculada
        <div class="field-wrapper field-calc" style="@wrapperStyle">
            @if (hasLabel)
            {
                <label for="@fieldId" class="form-label">
                    @label
                </label>
            }
            <input type="date"
                   class="form-control form-control-calc"
                   id="@fieldId"
                   name="@fieldName"
                   title="@hint"
                   @(isDisabled ? "disabled" : "")
                   data-calc="true"
                   data-sag-codicamp="@sagCodicamp"
                   data-sag-nomecamp="@sagNomecamp"
                   data-sag-namecamp="@sagNamecamp"
                   data-sag-comptype="@sagComptype" />
        </div>
        break;

    case ComponentType.CalcComboBox:
        // EC - Combo calculado
        <div class="field-wrapper field-calc" style="@wrapperStyle">
            @if (hasLabel)
            {
                <label for="@fieldId" class="form-label">
                    @label
                </label>
            }
            <select class="form-select form-select-calc"
                    id="@fieldId"
                    name="@fieldName"
                    title="@hint"
                    @(isDisabled ? "disabled" : "")
                    data-calc="true"
                    data-sag-codicamp="@sagCodicamp"
                    data-sag-nomecamp="@sagNomecamp"
                   data-sag-namecamp="@sagNamecamp"
                    data-sag-comptype="@sagComptype">
                <option value="">Selecione...</option>
                @if (!string.IsNullOrEmpty(field.VareCamp))
                {
                    var calcDisplayOptions = field.VareCamp.Split(new[] { '|', '\n', '\r' }, StringSplitOptions.RemoveEmptyEntries);
                    var calcValueOptions = !string.IsNullOrEmpty(field.VaGrCamp)
                        ? field.VaGrCamp.Split(new[] { '|', '\n', '\r' }, StringSplitOptions.RemoveEmptyEntries)
                        : null;

                    for (var i = 0; i < calcDisplayOptions.Length; i++)
                    {
                        var displayText = calcDisplayOptions[i].Trim();
                        // Se VaGrCamp tem valor no mesmo índice, usa como value; senão usa o texto
                        var optValue = (calcValueOptions != null && i < calcValueOptions.Length)
                            ? calcValueOptions[i].Trim()
                            : displayText;
                        <option value="@optValue">@displayText</option>
                    }
                }
            </select>
        </div>
        break;

    case ComponentType.CalcCheckbox:
        // ES - Checkbox calculado
        var calcChecked = field.PadrCamp.HasValue && field.PadrCamp.Value == 1;
        <div class="field-wrapper field-calc" style="@wrapperStyle">
            <div class="form-check">
                <input type="hidden" name="@fieldName" value="0" />
                <input type="checkbox"
                       class="form-check-input form-check-calc"
                       id="@fieldId"
                       name="@fieldName"
                       value="1"
                       title="@hint"
                       @(calcChecked ? "checked" : "")
                       @(isDisabled ? "disabled" : "")
                       data-calc="true"
                       data-sag-codicamp="@sagCodicamp"
                       data-sag-nomecamp="@sagNomecamp"
                   data-sag-namecamp="@sagNamecamp"
                       data-sag-comptype="@sagComptype" />
                @if (hasLabel)
                {
                    <label for="@fieldId" class="form-check-label">
                        @label
                    </label>
                }
            </div>
        </div>
        break;

    case ComponentType.CalcMemo:
        // ET - Memo calculado
        var calcMemoRows = field.AltuCamp > 50 ? field.AltuCamp / 25 : 3;
        <div class="field-wrapper field-wrapper-full field-calc mb-3">
            @if (hasLabel)
            {
                <label for="@fieldId" class="form-label">
                    @label
                </label>
            }
            <textarea class="form-control form-control-calc"
                      id="@fieldId"
                      name="@fieldName"
                      title="@hint"
                      placeholder="@hint"
                      rows="@calcMemoRows"
                      @(isDisabled ? "disabled" : "")
                      data-calc="true"
                      data-sag-codicamp="@sagCodicamp"
                      data-sag-nomecamp="@sagNomecamp"
                   data-sag-namecamp="@sagNamecamp"
                      data-sag-comptype="@sagComptype"></textarea>
        </div>
        break;

    case ComponentType.CalcFileInput:
        // EA - Arquivo calculado
        <div class="field-wrapper field-calc" style="@wrapperStyle">
            @if (hasLabel)
            {
                <label for="@fieldId" class="form-label">
                    @label
                </label>
            }
            <div class="input-group">
                <input type="text"
                       class="form-control form-control-calc"
                       id="@fieldId"
                       name="@fieldName"
                       title="@hint"
                       placeholder="@hint"
                       @(isDisabled ? "disabled" : "")
                       data-calc="true"
                       data-sag-codicamp="@sagCodicamp"
                       data-sag-nomecamp="@sagNomecamp"
                   data-sag-namecamp="@sagNamecamp"
                       data-sag-comptype="@sagComptype" />
                <button type="button"
                        class="btn btn-outline-secondary btn-file"
                        title="Selecionar arquivo"
                        @(isDisabled ? "disabled" : "")>
                    <i class="bi bi-folder2-open"></i>
                </button>
            </div>
        </div>
        break;

    case ComponentType.DirectoryInput:
        // EI - Seletor de diretório
        <div class="field-wrapper field-calc" style="@wrapperStyle">
            @if (hasLabel)
            {
                <label for="@fieldId" class="form-label">
                    @label
                </label>
            }
            <div class="input-group">
                <input type="text"
                       class="form-control form-control-calc"
                       id="@fieldId"
                       name="@fieldName"
                       title="@hint"
                       placeholder="@hint"
                       @(isDisabled ? "disabled" : "")
                       data-calc="true"
                       data-sag-codicamp="@sagCodicamp"
                       data-sag-nomecamp="@sagNomecamp"
                   data-sag-namecamp="@sagNamecamp"
                       data-sag-comptype="@sagComptype" />
                <button type="button"
                        class="btn btn-outline-secondary btn-directory"
                        title="Selecionar diretório"
                        @(isDisabled ? "disabled" : "")>
                    <i class="bi bi-folder"></i>
                </button>
            </div>
        </div>
        break;

    // ============================================================
    // TIPOS INFO (readonly, dados de outra tabela)
    // Campos IE/IN/IM são vinculados a um lookup via VaGrCamp:
    //   Linha 0 = coluna a exibir (ex: NOMEPROD)
    //   Linha 1 = campo lookup (ex: CODIPROD)
    // ============================================================

    case ComponentType.InfoTextInput:
        // IE - Info texto readonly
        var ieTextVaGrLines = (field.VaGrCamp ?? "").Split(new[] { '\n', '\r', '|' }, StringSplitOptions.RemoveEmptyEntries);
        var ieTextSourceColumn = ieTextVaGrLines.Length >= 1 ? ieTextVaGrLines[0].Trim().ToUpper() : "";
        var ieTextLinkedLookup = ieTextVaGrLines.Length >= 2 ? ieTextVaGrLines[1].Trim().ToUpper() : "";
        <div class="field-wrapper field-info field-readonly" style="@wrapperStyle">
            @if (hasLabel)
            {
                <label for="@fieldId" class="form-label">
                    @label
                </label>
            }
            <input type="text"
                   class="form-control form-control-info"
                   id="@fieldId"
                   name="@fieldName"
                   title="@hint"
                   readonly
                   data-info="true"
                   data-sag-codicamp="@sagCodicamp"
                   data-sag-nomecamp="@sagNomecamp"
                   data-sag-namecamp="@sagNamecamp"
                   data-sag-comptype="@sagComptype"
                   @if (!string.IsNullOrEmpty(ieTextLinkedLookup)) {
                       <text>data-sag-linked-lookup="@ieTextLinkedLookup"</text>
                   }
                   @if (!string.IsNullOrEmpty(ieTextSourceColumn)) {
                       <text>data-sag-source-column="@ieTextSourceColumn"</text>
                   } />
        </div>
        break;

    case ComponentType.InfoNumberInput:
        // IN - Info número readonly
        var ieNumVaGrLines = (field.VaGrCamp ?? "").Split(new[] { '\n', '\r', '|' }, StringSplitOptions.RemoveEmptyEntries);
        var ieNumSourceColumn = ieNumVaGrLines.Length >= 1 ? ieNumVaGrLines[0].Trim().ToUpper() : "";
        var ieNumLinkedLookup = ieNumVaGrLines.Length >= 2 ? ieNumVaGrLines[1].Trim().ToUpper() : "";
        <div class="field-wrapper field-info field-readonly" style="@wrapperStyle">
            @if (hasLabel)
            {
                <label for="@fieldId" class="form-label">
                    @label
                </label>
            }
            <input type="number"
                   class="form-control form-control-info"
                   id="@fieldId"
                   name="@fieldName"
                   title="@hint"
                   readonly
                   data-info="true"
                   data-sag-codicamp="@sagCodicamp"
                   data-sag-nomecamp="@sagNomecamp"
                   data-sag-namecamp="@sagNamecamp"
                   data-sag-comptype="@sagComptype"
                   @if (!string.IsNullOrEmpty(ieNumLinkedLookup)) {
                       <text>data-sag-linked-lookup="@ieNumLinkedLookup"</text>
                   }
                   @if (!string.IsNullOrEmpty(ieNumSourceColumn)) {
                       <text>data-sag-source-column="@ieNumSourceColumn"</text>
                   } />
        </div>
        break;

    case ComponentType.InfoTextArea:
        // IM - Info memo readonly
        var ieMemoVaGrLines = (field.VaGrCamp ?? "").Split(new[] { '\n', '\r', '|' }, StringSplitOptions.RemoveEmptyEntries);
        var ieMemoSourceColumn = ieMemoVaGrLines.Length >= 1 ? ieMemoVaGrLines[0].Trim().ToUpper() : "";
        var ieMemoLinkedLookup = ieMemoVaGrLines.Length >= 2 ? ieMemoVaGrLines[1].Trim().ToUpper() : "";
        var infoMemoRows = field.AltuCamp > 50 ? field.AltuCamp / 25 : 3;
        <div class="field-wrapper field-wrapper-full field-info field-readonly mb-3">
            @if (hasLabel)
            {
                <label for="@fieldId" class="form-label">
                    @label
                </label>
            }
            <textarea class="form-control form-control-info"
                      id="@fieldId"
                      name="@fieldName"
                      title="@hint"
                      rows="@infoMemoRows"
                      readonly
                      data-info="true"
                      data-sag-codicamp="@sagCodicamp"
                      data-sag-nomecamp="@sagNomecamp"
                      data-sag-namecamp="@sagNamecamp"
                      data-sag-comptype="@sagComptype"
                      @if (!string.IsNullOrEmpty(ieMemoLinkedLookup)) {
                          <text>data-sag-linked-lookup="@ieMemoLinkedLookup"</text>
                      }
                      @if (!string.IsNullOrEmpty(ieMemoSourceColumn)) {
                          <text>data-sag-source-column="@ieMemoSourceColumn"</text>
                      }></textarea>
        </div>
        break;

    case ComponentType.InfoRichEdit:
        // IR - Info RichEdit readonly
        var ieRichVaGrLines = (field.VaGrCamp ?? "").Split(new[] { '\n', '\r', '|' }, StringSplitOptions.RemoveEmptyEntries);
        var ieRichSourceColumn = ieRichVaGrLines.Length >= 1 ? ieRichVaGrLines[0].Trim().ToUpper() : "";
        var ieRichLinkedLookup = ieRichVaGrLines.Length >= 2 ? ieRichVaGrLines[1].Trim().ToUpper() : "";
        var infoRichRows = field.AltuCamp > 50 ? field.AltuCamp / 25 : 5;
        <div class="field-wrapper field-wrapper-full field-info field-readonly mb-3">
            @if (hasLabel)
            {
                <label for="@fieldId" class="form-label">
                    @label
                </label>
            }
            <div class="form-control form-control-rich-info"
                 id="@fieldId"
                 style="min-height: @(infoRichRows * 25)px;"
                 data-info="true"
                 data-rich="true"
                 data-sag-codicamp="@sagCodicamp"
                 data-sag-nomecamp="@sagNomecamp"
                 data-sag-namecamp="@sagNamecamp"
                 data-sag-comptype="@sagComptype"
                 @if (!string.IsNullOrEmpty(ieRichLinkedLookup)) {
                     <text>data-sag-linked-lookup="@ieRichLinkedLookup"</text>
                 }
                 @if (!string.IsNullOrEmpty(ieRichSourceColumn)) {
                     <text>data-sag-source-column="@ieRichSourceColumn"</text>
                 }>
            </div>
        </div>
        break;

    // ============================================================
    // TIPOS RICHEDIT
    // ============================================================

    case ComponentType.RichEdit:
    case ComponentType.RichEditBlob:
        // RM, RB - RichEdit
        var richRows = field.AltuCamp > 50 ? field.AltuCamp / 25 : 5;
        <div class="field-wrapper field-wrapper-full mb-3 @readonlyClass">
            @if (hasLabel)
            {
                <label for="@fieldId" class="form-label">
                    @label
                    @if (isRequired)
                    {
                        <span class="text-danger">*</span>
                    }
                </label>
            }
            <div class="form-control form-control-rich"
                 id="@fieldId"
                 contenteditable="@(!isDisabled)"
                 style="min-height: @(richRows * 25)px;"
                 data-rich="true">
            </div>
            <input type="hidden" name="@fieldName" id="@(fieldId)_hidden" />
        </div>
        break;

    // ============================================================
    // TIPOS ADVANCED MEMO (com syntax highlighting)
    // ============================================================

    case ComponentType.AdvMemoSQL:
    case ComponentType.AdvMemoGeneral:
    case ComponentType.AdvMemoINI:
    case ComponentType.AdvMemoPascal:
    case ComponentType.AdvMemoXML:
    case ComponentType.AdvRichSQL:
    case ComponentType.AdvRichGeneral:
    case ComponentType.AdvRichINI:
    case ComponentType.AdvRichPascal:
    case ComponentType.AdvRichXML:
        // BS, BE, BI, BP, BX, RS, RE, RI, RP, RX - Memos avançados
        var advMemoRows = field.AltuCamp > 50 ? field.AltuCamp / 25 : 8;
        var syntaxType = componentType switch
        {
            ComponentType.AdvMemoSQL or ComponentType.AdvRichSQL => "sql",
            ComponentType.AdvMemoINI or ComponentType.AdvRichINI => "ini",
            ComponentType.AdvMemoPascal or ComponentType.AdvRichPascal => "pascal",
            ComponentType.AdvMemoXML or ComponentType.AdvRichXML => "xml",
            _ => "text"
        };
        <div class="field-wrapper field-wrapper-full field-advanced-memo mb-3 @readonlyClass">
            @if (hasLabel)
            {
                <label for="@fieldId" class="form-label">
                    @label
                    @if (isRequired)
                    {
                        <span class="text-danger">*</span>
                    }
                </label>
            }
            <textarea class="form-control form-control-code"
                      id="@fieldId"
                      name="@fieldName"
                      title="@hint"
                      rows="@advMemoRows"
                      @(isRequired ? "required" : "")
                      @(isDisabled ? "disabled" : "")
                      data-syntax="@syntaxType"
                      spellcheck="false"></textarea>
        </div>
        break;

    // ============================================================
    // TIPOS VISUAIS
    // ============================================================

    case ComponentType.Label:
        // LBL - Label estático
        <div class="field-wrapper field-label" style="@wrapperStyle">
            <span class="field-static-label" title="@hint">@label</span>
        </div>
        break;

    case ComponentType.Button:
        // BTN - Botão
        // No Delphi, ExprCamp contém as instruções PLSAG a executar no OnClick
        // O "&" no label era para shortcut no Delphi (ex: "&Promoções" = Alt+P), removemos na web
        var btnExprCamp = field.ExprCamp ?? "";
        var btnLabel = (label ?? "").Replace("&", "");
        <div class="field-wrapper field-button d-flex align-items-end" style="@wrapperStyle">
            <button type="button"
                    class="btn btn-primary sag-action-btn"
                    id="@fieldId"
                    title="@(!string.IsNullOrEmpty(hint) ? hint : btnLabel)"
                    @(isDisabled ? "disabled" : "")
                    data-sag-codicamp="@sagCodicamp"
                    data-sag-nomecamp="@sagNomecamp"
                    data-sag-namecamp="@sagNamecamp"
                    data-sag-comptype="@sagComptype"
                    @if (!string.IsNullOrEmpty(btnExprCamp)) {
                        <text>data-plsag-onclick="@btnExprCamp"</text>
                    }>
                <i class="bi bi-lightning-charge me-1"></i>@btnLabel
            </button>
        </div>
        break;

    case ComponentType.DataGrid:
        // DBG - Grid de dados (placeholder visual)
        <div class="field-wrapper field-wrapper-full field-grid mb-3">
            <div class="data-grid-placeholder border rounded p-3 bg-light">
                @if (hasLabel)
                {
                    <div class="data-grid-header mb-2">
                        <strong>@label</strong>
                    </div>
                }
                <div class="data-grid-content text-muted">
                    <small>[Grid: @fieldName]</small>
                </div>
            </div>
        </div>
        break;

    case ComponentType.Chart:
        // GRA - Gráfico (placeholder visual)
        <div class="field-wrapper field-wrapper-full field-chart mb-3">
            <div class="chart-placeholder border rounded p-3 bg-light text-center">
                @if (hasLabel)
                {
                    <div class="chart-header mb-2">
                        <strong>@label</strong>
                    </div>
                }
                <div class="chart-content text-muted">
                    <i class="bi bi-bar-chart-fill fs-1"></i>
                    <br />
                    <small>[Gráfico: @fieldName]</small>
                </div>
            </div>
        </div>
        break;

    case ComponentType.Timer:
        // TIM - Timer (não visual, mas precisa de data-attribute para JavaScript inicializar)
        // PadrCamp = intervalo em segundos
        // ExprCamp = instruções PLSAG a executar
        var timerInterval = field.PadrCamp ?? 0;
        var timerInstructions = field.ExprCamp ?? "";
        if (timerInterval > 0)
        {
            <script type="application/json"
                    class="sag-timer-config"
                    data-timer-name="@field.NomeCamp"
                    data-timer-interval="@(timerInterval * 1000)"
                    data-timer-enabled="true">
            {
                "name": "@field.NomeCamp",
                "interval": @(timerInterval * 1000),
                "instructions": @Html.Raw(System.Text.Json.JsonSerializer.Serialize(timerInstructions)),
                "enabled": true
            }
            </script>
        }
        break;

    case ComponentType.CheckList:
        // LC - Lista de checkboxes
        <div class="field-wrapper field-wrapper-full field-checklist mb-3 @readonlyClass">
            @if (hasLabel)
            {
                <label class="form-label">
                    @label
                </label>
            }
            <div class="checklist-container border rounded p-2">
                @if (!string.IsNullOrEmpty(field.VareCamp))
                {
                    var checklistOptions = field.VareCamp.Split(new[] { '|', '\n', '\r' }, StringSplitOptions.RemoveEmptyEntries);
                    var clIndex = 0;
                    foreach (var opt in checklistOptions)
                    {
                        var trimmed = opt.Trim();
                        var parts = trimmed.Split('=', 2);
                        var optValue = parts.Length > 1 ? parts[0].Trim() : clIndex.ToString();
                        var optDisplay = parts.Length > 1 ? parts[1].Trim() : trimmed;
                        <div class="form-check">
                            <input type="checkbox"
                                   class="form-check-input"
                                   id="@(fieldId)_@clIndex"
                                   name="@(fieldName)[]"
                                   value="@optValue"
                                   @(isDisabled ? "disabled" : "") />
                            <label class="form-check-label" for="@(fieldId)_@clIndex">
                                @optDisplay
                            </label>
                        </div>
                        clIndex++;
                    }
                }
                else
                {
                    <small class="text-muted">[Lista vazia]</small>
                }
            </div>
        </div>
        break;

    // ============================================================
    // TIPOS DE IMAGEM
    // ============================================================

    case ComponentType.ImageEditable:
        // FE - Imagem editável (upload)
        <div class="field-wrapper field-image @readonlyClass" style="@wrapperStyle">
            @if (hasLabel)
            {
                <label for="@fieldId" class="form-label">
                    @label
                </label>
            }
            <div class="image-container border rounded p-2">
                <img id="@(fieldId)_preview"
                     class="img-thumbnail mb-2"
                     style="max-height: @(field.AltuCamp > 0 ? field.AltuCamp : 150)px; display: none;"
                     alt="Preview" />
                <input type="file"
                       class="form-control"
                       id="@fieldId"
                       name="@fieldName"
                       accept="image/*"
                       @(isDisabled ? "disabled" : "")
                       data-image-upload="true" />
            </div>
        </div>
        break;

    case ComponentType.ImageReadonly:
        // FI - Imagem somente leitura
        <div class="field-wrapper field-image field-readonly" style="@wrapperStyle">
            @if (hasLabel)
            {
                <label class="form-label">
                    @label
                </label>
            }
            <div class="image-container border rounded p-2 bg-light">
                <img id="@(fieldId)_image"
                     class="img-thumbnail"
                     style="max-height: @(field.AltuCamp > 0 ? field.AltuCamp : 150)px;"
                     alt="@label"
                     src=""
                     data-image-readonly="true" />
            </div>
        </div>
        break;

    case ComponentType.ImageFixed:
        // FF - Imagem fixa (do banco ou recurso)
        <div class="field-wrapper field-image field-readonly" style="@wrapperStyle">
            @if (hasLabel)
            {
                <label class="form-label">
                    @label
                </label>
            }
            <div class="image-container">
                <img id="@(fieldId)_image"
                     class="img-fluid"
                     style="max-height: @(field.AltuCamp > 0 ? field.AltuCamp : 150)px;"
                     alt="@label"
                     src=""
                     data-image-fixed="true" />
            </div>
        </div>
        break;

    // ============================================================
    // BEVEL (tratado em _FormContent.cshtml, não aqui)
    // ============================================================

    case ComponentType.Bevel:
        // BVL - Agrupador visual - não renderiza aqui
        break;

    // ============================================================
    // HIDDEN (não deve ser renderizado)
    // ============================================================

    case ComponentType.Hidden:
        // Campos ocultos (DEPOSHOW, ATUAGRID) - não renderiza
        break;

    // ============================================================
    // FALLBACK
    // ============================================================

    default:
        // Fallback para input text
        <div class="field-wrapper" style="@wrapperStyle">
            @if (hasLabel)
            {
                <label for="@fieldId" class="form-label">@label</label>
            }
            <input type="text"
                   class="form-control"
                   id="@fieldId"
                   name="@fieldName"
                   title="@hint"
                   @(isDisabled ? "disabled" : "") />
        </div>
        break;
}
