<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Config. Leitura Serial/Impress&#xE3;o - SagPoc.Web</title>
    
    <link rel="stylesheet" href="/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
    <link rel="stylesheet" href="/css/site.css?v=j6fhJSuuyLpOSLuPJU0TsDV0iNjor5S3rDnvxJrt4bg" />
    <link rel="stylesheet" href="/css/form-renderer.css?v=uysvgXBvegus4dssbmlSSmFKe3QaHxfybeDWvNQPBf8" />
    <link rel="stylesheet" href="/SagPoc.Web.styles.css?v=HK8pM9HNVohpMIyqYc_0utR_alZF-CCSYZOWVkQwu4w" />
</head>
<body>
    <header b-k2ctk0jt16>
        <nav b-k2ctk0jt16 class="navbar navbar-expand-sm navbar-toggleable-sm navbar-light bg-white border-bottom box-shadow mb-3">
            <div b-k2ctk0jt16 class="container-fluid">
                <a class="navbar-brand" href="/">SagPoc.Web</a>
                <button b-k2ctk0jt16 class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target=".navbar-collapse" aria-controls="navbarSupportedContent"
                        aria-expanded="false" aria-label="Toggle navigation">
                    <span b-k2ctk0jt16 class="navbar-toggler-icon"></span>
                </button>
                <div b-k2ctk0jt16 class="navbar-collapse collapse d-sm-inline-flex justify-content-between">
                    <ul b-k2ctk0jt16 class="navbar-nav flex-grow-1">
                        <li b-k2ctk0jt16 class="nav-item">
                            <a class="nav-link text-dark" href="/">Home</a>
                        </li>
                        <li b-k2ctk0jt16 class="nav-item">
                            <a class="nav-link text-dark" href="/Form">Formulários</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>
    <div b-k2ctk0jt16 class="container">
        <main b-k2ctk0jt16 role="main" class="pb-3">
            
<link rel="stylesheet" href="/css/consulta-grid.css" />

<div class="container-fluid mt-3">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h4 class="mb-0">Config. Leitura Serial/Impress&#xE3;o</h4>
        <div>
            <span class="badge bg-info">32 campos</span>
                <span class="badge bg-success ms-1">1 consultas</span>
            <a class="btn btn-outline-secondary btn-sm ms-2" href="/Form">Voltar</a>
        </div>
    </div>

        <!-- Layout com Guia Consulta + Guias de Dados -->
        <ul class="nav nav-tabs" id="mainTabs" role="tablist">
            <!-- Tab Consulta -->
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="tab-consulta-tab"
                        data-bs-toggle="tab" data-bs-target="#tab-consulta"
                        type="button" role="tab" aria-controls="tab-consulta" aria-selected="true">
                    Consulta
                </button>
            </li>
            <!-- Tab Dados (primeira guia) -->
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="tab-dados-tab"
                        data-bs-toggle="tab" data-bs-target="#tab-dados"
                        type="button" role="tab" aria-controls="tab-dados" aria-selected="false">
                    Dados Gerais
                </button>
            </li>
                <!-- Tab Dados 2 (segunda guia) -->
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="tab-dados2-tab"
                            data-bs-toggle="tab" data-bs-target="#tab-dados2"
                            type="button" role="tab" aria-controls="tab-dados2" aria-selected="false">
                        Dados Adicionais
                    </button>
                </li>
        </ul>
        <div class="tab-content" id="mainTabsContent">
            <!-- Conteudo Tab Consulta -->
            <div class="tab-pane fade show active" id="tab-consulta" role="tabpanel" aria-labelledby="tab-consulta-tab">
                <div class="p-3">
                    
<div class="consulta-container" id="consultaContainer" data-table-id="715">
    <!-- Barra de ferramentas -->
    <div class="row mb-3">
        <div class="col-md-4">
            <label class="form-label fw-bold">Consulta</label>
            <select id="consultaSelect" class="form-select">
                    <option value="715000" data-busc="LESI000-Padrao">
                        LESI000-Padrao
                    </option>
            </select>
        </div>
        <div class="col-md-8 d-flex align-items-end">
            <button type="button" class="btn btn-outline-secondary me-2" id="btnRefresh" title="Atualizar">
                <i class="bi bi-arrow-clockwise"></i> Atualizar
            </button>
        </div>
    </div>

    <!-- Filtros -->
    <div class="card mb-3">
        <div class="card-body py-2">
            <div class="row g-2 align-items-center" id="filterRow">
                <div class="col-md-3">
                    <select id="filterField" class="form-select form-select-sm">
                        <option value="">-- Campo --</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <select id="filterCondition" class="form-select form-select-sm">
                        <option value="startswith">Iniciado por</option>
                        <option value="contains" selected>Contém</option>
                        <option value="equals">Igual a</option>
                        <option value="notequals">Diferente de</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <input type="text" id="filterValue" class="form-control form-control-sm" placeholder="Localiza...">
                </div>
                <div class="col-md-4 d-flex gap-2">
                    <button type="button" class="btn btn-primary btn-sm" id="btnAddFilter">
                        <i class="bi bi-funnel"></i> Filtrar
                    </button>
                    <button type="button" class="btn btn-outline-secondary btn-sm" id="btnClearFilters">
                        <i class="bi bi-x-circle"></i> Limpar
                    </button>
                </div>
            </div>
            <!-- Tags de filtros ativos -->
            <div id="activeFilters" class="mt-2"></div>
        </div>
    </div>

    <!-- Grid -->
    <div class="table-responsive">
        <table class="table table-striped table-hover table-sm" id="consultaGrid">
            <thead class="table-dark">
                <tr id="gridHeader"></tr>
            </thead>
            <tbody id="gridBody">
                <tr>
                    <td colspan="10" class="text-center text-muted py-4">
                        Selecione uma consulta para carregar os dados...
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Paginacao -->
    <div class="d-flex justify-content-between align-items-center mt-2">
        <div class="text-muted" id="gridInfo">
            Mostrando 0 registros
        </div>
        <nav>
            <ul class="pagination pagination-sm mb-0" id="gridPagination">
            </ul>
        </nav>
    </div>

    <hr class="my-3">

    <!-- Botoes CRUD -->
    <div class="d-flex gap-2">
            <button type="button" class="btn btn-success" id="btnIncluir">
                <i class="bi bi-plus-circle"></i> Incluir
            </button>
            <button type="button" class="btn btn-primary" id="btnAlterar" disabled>
                <i class="bi bi-pencil"></i> Alterar
            </button>
            <button type="button" class="btn btn-danger" id="btnExcluir" disabled>
                <i class="bi bi-trash"></i> Excluir
            </button>
    </div>
</div>

                </div>
            </div>

            <!-- Conteudo Tab Dados -->
            <div class="tab-pane fade" id="tab-dados" role="tabpanel" aria-labelledby="tab-dados-tab">
                <div class="p-3">
                    
<form id="dynamicForm" class="needs-validation" novalidate>
    <input type="hidden" id="editingRecordId" name="editingRecordId" value="" />


            <fieldset class="bevel-group mb-3">
                <div class="bevel-content">


    <div class="field-row field-row-multi">


        <div class="field-wrapper" style="">
                <label for="field_715001" class="form-label">
                    Tipo Leitura
                </label>
            <select class="form-select"
                    id="field_715001"
                    name="TIPOLESI"
                    title="Tipo Leitura"
                    
                    >
                <option value="">Selecione...</option>
                        <option value="0">NFC-e</option>
                        <option value="1">Abatedouro</option>
                        <option value="2">Expedi&#xE7;&#xE3;o</option>
            </select>
        </div>


        <div class="field-wrapper" style="">
                <label for="field_715002" class="form-label">
                    M&#xE1;quina
                </label>
            <input type="text"
                   class="form-control"
                   id="field_715002"
                   name="MAQULESI"
                   title="M&#xE1;quina"
                   placeholder="M&#xE1;quina"
                   
                   
                   data-mask="" />
        </div>
    </div>
                </div>
            </fieldset>
            <fieldset class="bevel-group mb-3">
                <div class="bevel-content">


    <div class="field-row field-row-multi">


        <div class="field-wrapper" style="">
                <label for="field_715004" class="form-label">
                    Tipo de Impress&#xE3;o
                </label>
            <select class="form-select"
                    id="field_715004"
                    name="TPIPLESI"
                    title="Tipo de Impress&#xE3;o"
                    
                    >
                <option value="">Selecione...</option>
                        <option value="0">COM</option>
                        <option value="1">Spooler</option>
            </select>
        </div>


        <div class="field-wrapper" style="">
                <label for="field_715005" class="form-label">
                    Nome Impressora
                </label>
            <input type="text"
                   class="form-control"
                   id="field_715005"
                   name="IMPRLESI"
                   title="Nome Impressora"
                   placeholder="Nome Impressora"
                   
                   
                   data-mask="" />
        </div>


        <div class="field-wrapper" style="">
                <label for="field_715006" class="form-label">
                    Modelo Impressora
                </label>
            <select class="form-select"
                    id="field_715006"
                    name="MODELESI"
                    title="Modelo Impressora"
                    
                    >
                <option value="">Selecione...</option>
                        <option value="0">Epson</option>
                        <option value="1">Bematech</option>
                        <option value="2">Daruma</option>
                        <option value="3">Elgin</option>
                        <option value="4">Diebold</option>
            </select>
        </div>
    </div>


    <div class="field-row field-row-multi">


        <div class="field-wrapper" style="">
                <label for="field_715007" class="form-label">
                    Porta
                </label>
            <input type="text"
                   class="form-control"
                   id="field_715007"
                   name="PORTLESI"
                   title="Porta"
                   placeholder="Porta"
                   
                   
                   data-mask="" />
        </div>


        <div class="field-wrapper" style="">
            <div class="form-check">
                <input type="hidden" name="PDF_LESI" value="0" />
                <input type="checkbox"
                       class="form-check-input"
                       id="field_715011"
                       name="PDF_LESI"
                       value="1"
                       title="Salvar Arquivo PDF"
                       
                        />
                    <label for="field_715011" class="form-check-label">
                        Salvar Arquivo PDF
                    </label>
            </div>
        </div>


        <div class="field-wrapper" style="">
                <label for="field_715008" class="form-label">
                    BaudRate
                </label>
            <input type="number"
                   class="form-control"
                   id="field_715008"
                   name="BAUDLESI"
                   title="BaudRate"
                   placeholder="BaudRate"
                   min=&quot;0&quot;
                   max=&quot;0&quot;
                   step="1"
                   
                    />
        </div>


        <div class="field-wrapper" style="">
            <div class="form-check">
                <input type="hidden" name="PREVLESI" value="0" />
                <input type="checkbox"
                       class="form-check-input"
                       id="field_715012"
                       name="PREVLESI"
                       value="1"
                       title="Vizualizar Docto. ao Imprimir"
                       
                        />
                    <label for="field_715012" class="form-check-label">
                        Vizualizar Docto. ao Imprimir
                    </label>
            </div>
        </div>


        <div class="field-wrapper" style="">
                <label for="field_715009" class="form-label">
                    Linhas entre Cupons
                </label>
            <input type="number"
                   class="form-control"
                   id="field_715009"
                   name="LICPLESI"
                   title="Linhas entre Cupons"
                   placeholder="Linhas entre Cupons"
                   min=&quot;0&quot;
                   max=&quot;0&quot;
                   step="1"
                   
                    />
        </div>


        <div class="field-wrapper" style="">
            <div class="form-check">
                <input type="hidden" name="DIAGLESI" value="0" />
                <input type="checkbox"
                       class="form-check-input"
                       id="field_715013"
                       name="DIAGLESI"
                       value="1"
                       title="Imprimir diretamente na Impressora"
                       
                        />
                    <label for="field_715013" class="form-check-label">
                        Imprimir diret. na Impressora
                    </label>
            </div>
        </div>
    </div>


    <div class="field-row field-row-multi">


        <div class="field-wrapper" style="">
                <label for="field_715014" class="form-label">
                    Margem Esquerda
                </label>
            <input type="number"
                   class="form-control"
                   id="field_715014"
                   name="MARELESI"
                   title="Margem Esquerda"
                   placeholder="Margem Esquerda"
                   min=&quot;0&quot;
                   max=&quot;0&quot;
                   step="0.01"
                   
                    />
        </div>


        <div class="field-wrapper" style="">
                <label for="field_715015" class="form-label">
                    Margem Direita
                </label>
            <input type="number"
                   class="form-control"
                   id="field_715015"
                   name="MARDLESI"
                   title="Margem Direita"
                   placeholder="Margem Direita"
                   min=&quot;0&quot;
                   max=&quot;0&quot;
                   step="0.01"
                   
                    />
        </div>


        <div class="field-wrapper" style="">
                <label for="field_715016" class="form-label">
                    Margem Superior
                </label>
            <input type="number"
                   class="form-control"
                   id="field_715016"
                   name="MARTLESI"
                   title="Margem Superior"
                   placeholder="Margem Superior"
                   min=&quot;0&quot;
                   max=&quot;0&quot;
                   step="0.01"
                   
                    />
        </div>


        <div class="field-wrapper" style="">
                <label for="field_715017" class="form-label">
                    Margem Inferior
                </label>
            <input type="number"
                   class="form-control"
                   id="field_715017"
                   name="MARRLESI"
                   title="Margem Inferior"
                   placeholder="Margem Inferior"
                   min=&quot;0&quot;
                   max=&quot;0&quot;
                   step="0.01"
                   
                    />
        </div>
    </div>
                </div>
            </fieldset>
            <fieldset class="bevel-group mb-3">
                <div class="bevel-content">


    <div class="field-row field-row-multi">


        <div class="field-wrapper" style="">
                <label for="field_715020" class="form-label">
                    Byte Size
                </label>
            <input type="number"
                   class="form-control"
                   id="field_715020"
                   name="BYTELESI"
                   title="Byte Size"
                   placeholder="Byte Size"
                   min=&quot;0&quot;
                   max=&quot;0&quot;
                   step="1"
                   
                    />
        </div>


        <div class="field-wrapper" style="">
                <label for="field_715021" class="form-label">
                    StopBits
                </label>
            <input type="number"
                   class="form-control"
                   id="field_715021"
                   name="STOPLESI"
                   title="StopBits"
                   placeholder="StopBits"
                   min=&quot;0&quot;
                   max=&quot;0&quot;
                   step="1"
                   
                    />
        </div>
    </div>


    <div class="field-row field-row-multi">


        <div class="field-wrapper" style="">
                <label for="field_715022" class="form-label">
                    Parity
                </label>
            <select class="form-select"
                    id="field_715022"
                    name="PARILESI"
                    title="Parity"
                    
                    >
                <option value="">Selecione...</option>
                        <option value="0">Sem paridade (None)</option>
                        <option value="1">Paridade Impar (Odd)</option>
                        <option value="2">Paridade Par (Even)</option>
                        <option value="3">Marca (Mark)</option>
                        <option value="4">Espa&#xE7;o (Space)</option>
            </select>
        </div>


        <div class="field-wrapper" style="">
                <label for="field_715023" class="form-label">
                    Timer de Sinal
                </label>
            <input type="number"
                   class="form-control"
                   id="field_715023"
                   name="TIMELESI"
                   title="Timer de Sinal"
                   placeholder="Timer de Sinal"
                   min=&quot;0&quot;
                   max=&quot;0&quot;
                   step="1"
                   
                    />
        </div>


        <div class="field-wrapper" style="">
                <label for="field_715024" class="form-label">
                    Tamanho
                </label>
            <input type="number"
                   class="form-control"
                   id="field_715024"
                   name="TAMALESI"
                   title="Tamanho"
                   placeholder="Tamanho"
                   min=&quot;0&quot;
                   max=&quot;0&quot;
                   step="1"
                   
                    />
        </div>


        <div class="field-wrapper" style="">
                <label for="field_715025" class="form-label">
                    Posi&#xE7;&#xE3;o Inicial
                </label>
            <input type="number"
                   class="form-control"
                   id="field_715025"
                   name="INICLESI"
                   title="Posi&#xE7;&#xE3;o Inicial"
                   placeholder="Posi&#xE7;&#xE3;o Inicial"
                   min=&quot;0&quot;
                   max=&quot;0&quot;
                   step="1"
                   
                    />
        </div>
    </div>


    <div class="field-row field-row-multi">


        <div class="field-wrapper" style="">
                <label for="field_715026" class="form-label">
                    Tamanho Copy
                </label>
            <input type="number"
                   class="form-control"
                   id="field_715026"
                   name="COPYLESI"
                   title="Tamanho Copy"
                   placeholder="Tamanho Copy"
                   min=&quot;0&quot;
                   max=&quot;0&quot;
                   step="1"
                   
                    />
        </div>


        <div class="field-wrapper" style="">
                <label for="field_715027" class="form-label">
                    Compara&#xE7;&#xE3;o
                </label>
            <input type="text"
                   class="form-control"
                   id="field_715027"
                   name="COMPLESI"
                   title="Compara&#xE7;&#xE3;o"
                   placeholder="Compara&#xE7;&#xE3;o"
                   
                   
                   data-mask="" />
        </div>


        <div class="field-wrapper" style="">
                <label for="field_715028" class="form-label">
                    Chr Quebra Linha
                </label>
            <input type="number"
                   class="form-control"
                   id="field_715028"
                   name="QUNULESI"
                   title="Chr Quebra Linha"
                   placeholder="Chr Quebra Linha"
                   min=&quot;0&quot;
                   max=&quot;0&quot;
                   step="1"
                   
                    />
        </div>


        <div class="field-wrapper" style="">
                <label for="field_715029" class="form-label">
                    Resposta Positiva
                </label>
            <input type="text"
                   class="form-control"
                   id="field_715029"
                   name="POSILESI"
                   title="Resposta Positiva"
                   placeholder="Resposta Positiva"
                   
                   
                   data-mask="" />
        </div>
    </div>


    <div class="field-row field-row-multi">


        <div class="field-wrapper" style="">
                <label for="field_715030" class="form-label">
                    Resposta Negativa
                </label>
            <input type="text"
                   class="form-control"
                   id="field_715030"
                   name="NEGALESI"
                   title="Resposta Negativa"
                   placeholder="Resposta Negativa"
                   
                   
                   data-mask="" />
        </div>


        <div class="field-wrapper" style="">
                <label for="field_715031" class="form-label">
                    Controle
                </label>
            <select class="form-select"
                    id="field_715031"
                    name="CONTLESI"
                    title="Controle"
                    
                    >
                <option value="">Selecione...</option>
                        <option value="0">Hardware</option>
                        <option value="1">Software</option>
                        <option value="2">Nada</option>
                        <option value="3">Personalizado</option>
            </select>
        </div>


        <div class="field-wrapper" style="">
                <label for="field_715032" class="form-label">
                    Tipo de Resposta
                </label>
            <select class="form-select"
                    id="field_715032"
                    name="TPRELESI"
                    title="Tipo de Resposta"
                    
                    >
                <option value="">Selecione...</option>
                        <option value="0">CHR</option>
                        <option value="1">Normal</option>
            </select>
        </div>


        <div class="field-wrapper" style="">
                <label for="field_715033" class="form-label">
                    Sincroniza&#xE7;&#xE3;o
                </label>
            <select class="form-select"
                    id="field_715033"
                    name="SINCLESI"
                    title="Sincroniza&#xE7;&#xE3;o"
                    
                    >
                <option value="">Selecione...</option>
                        <option value="0">Linha de Execu&#xE7;&#xE3;o</option>
                        <option value="1">Windows</option>
                        <option value="2">Nada</option>
            </select>
        </div>
    </div>
                </div>
            </fieldset>

    <hr class="my-4" />

    <div class="d-flex gap-2">
        <button type="submit" class="btn btn-primary">
            <i class="bi bi-check-lg"></i> Salvar
        </button>
        <button type="button" class="btn btn-outline-secondary" id="btnCancelar">
            <i class="bi bi-x-lg"></i> Cancelar
        </button>
    </div>
</form>

<script>
    document.getElementById('btnCancelar')?.addEventListener('click', function() {
        // Volta para a tab Consulta
        document.getElementById('tab-consulta-tab')?.click();
    });
</script>

                </div>
            </div>

                <!-- Conteudo Tab Dados 2 -->
                <div class="tab-pane fade" id="tab-dados2" role="tabpanel" aria-labelledby="tab-dados2-tab">
                    <div class="p-3">
                    </div>
                </div>
        </div>
</div>


        </main>
    </div>

    <footer b-k2ctk0jt16 class="border-top footer text-muted">
        <div b-k2ctk0jt16 class="container">
            &copy; 2025 - SagPoc.Web - <a href="/Home/Privacy">Privacy</a>
        </div>
    </footer>
    <script src="/lib/jquery/dist/jquery.min.js"></script>
    <script src="/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/site.js?v=hRQyftXiu1lLX2P9Ly9xa4gHJgLeR1uGN5qegUobtGo"></script>
    
    <script src="/js/consulta-grid.js"></script>
    <script>
        // Validacao Bootstrap
        (function () {
            'use strict'
            var forms = document.querySelectorAll('.needs-validation')
            Array.prototype.slice.call(forms).forEach(function (form) {
                form.addEventListener('submit', function (event) {
                    event.preventDefault();
                    if (!form.checkValidity()) {
                        event.stopPropagation();
                    } else {
                        // Salvar via AJAX
                        saveForm(form);
                    }
                    form.classList.add('was-validated');
                }, false)
            })
        })()

        // Funcao para salvar formulario
        async function saveForm(form) {
            const formData = new FormData(form);
            const fields = {};
            formData.forEach((value, key) => {
                fields[key] = value;
            });

            // Garantir que checkboxes nao marcados enviem valor 0
            form.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                if (!cb.checked && cb.name) {
                    fields[cb.name] = '0';
                }
            });

            const tableId = 715;
            const recordId = document.getElementById('editingRecordId')?.value || null;

            try {
                const response = await fetch('/Form/SaveRecord', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        tableId: tableId,
                        recordId: recordId ? parseInt(recordId) : null,
                        fields: fields
                    })
                });

                const result = await response.json();
                if (result.success) {
                    alert(result.message);
                    // Volta para tab Consulta e recarrega
                    if (window.consultaGrid) {
                        document.getElementById('tab-consulta-tab')?.click();
                        window.consultaGrid.loadData();
                    }
                } else {
                    alert('Erro: ' + result.message);
                }
            } catch (error) {
                console.error('Erro ao salvar:', error);
                alert('Erro ao salvar registro');
            }
        }
    </script>

</body>
</html>
