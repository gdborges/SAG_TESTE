<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Contratos - SagPoc.Web</title>
    
    <!-- Google Fonts - Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <!-- Stylesheets -->
    <link rel="stylesheet" href="/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
    <link rel="stylesheet" href="/css/site.css?v=j6fhJSuuyLpOSLuPJU0TsDV0iNjor5S3rDnvxJrt4bg" />
    <link rel="stylesheet" href="/css/form-renderer.css?v=vRReg7cEWsFKfPhfscraMWayjhwhPwpBBiRhr62yRIg" />
    <link rel="stylesheet" href="/css/vision-theme.css?v=Z4YXlwLen67E3AikOL14ZLnADPK0jAhW3sQd7dJrtqc" />
    <link rel="stylesheet" href="/SagPoc.Web.styles.css?v=HK8pM9HNVohpMIyqYc_0utR_alZF-CCSYZOWVkQwu4w" />
</head>
<body>
    <header b-k2ctk0jt16>
        <nav b-k2ctk0jt16 class="navbar navbar-expand-sm navbar-toggleable-sm navbar-light bg-white border-bottom box-shadow mb-3">
            <div b-k2ctk0jt16 class="container-fluid">
                <a class="navbar-brand" href="/">SagPoc.Web</a>
                <button b-k2ctk0jt16 class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target=".navbar-collapse" aria-controls="navbarSupportedContent"
                        aria-expanded="false" aria-label="Toggle navigation">
                    <span b-k2ctk0jt16 class="navbar-toggler-icon"></span>
                </button>
                <div b-k2ctk0jt16 class="navbar-collapse collapse d-sm-inline-flex justify-content-between">
                    <ul b-k2ctk0jt16 class="navbar-nav flex-grow-1">
                        <li b-k2ctk0jt16 class="nav-item">
                            <a class="nav-link text-dark" href="/">Home</a>
                        </li>
                        <li b-k2ctk0jt16 class="nav-item">
                            <a class="nav-link text-dark" href="/Form">Formulários</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>
    <div b-k2ctk0jt16 class="container">
        <main b-k2ctk0jt16 role="main" class="pb-3">
            
<link rel="stylesheet" href="/css/consulta-grid.css" />

<div class="container-fluid mt-3">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h4 class="mb-0">Contratos</h4>
        <div>
            <span class="badge bg-info">22 campos</span>
                <span class="badge bg-success ms-1">2 consultas</span>
            <a class="btn btn-outline-secondary btn-sm ms-2" href="/Form">Voltar</a>
        </div>
    </div>

        <!-- Layout com Guia Consulta + Guias de Dados -->
        <ul class="nav nav-tabs" id="mainTabs" role="tablist">
            <!-- Tab Consulta -->
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="tab-consulta-tab"
                        data-bs-toggle="tab" data-bs-target="#tab-consulta"
                        type="button" role="tab" aria-controls="tab-consulta" aria-selected="true">
                    Consulta
                </button>
            </li>
            <!-- Tab Dados (primeira guia) -->
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="tab-dados-tab"
                        data-bs-toggle="tab" data-bs-target="#tab-dados"
                        type="button" role="tab" aria-controls="tab-dados" aria-selected="false">
                    Dados Gerais
                </button>
            </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="tab-mov-125-tab"
                                data-bs-toggle="tab" data-bs-target="#tab-mov-125"
                                type="button" role="tab" aria-controls="tab-mov-125" aria-selected="false">
                            Movimento 125
                        </button>
                    </li>
        </ul>
        <div class="tab-content" id="mainTabsContent">
            <!-- Conteudo Tab Consulta -->
            <div class="tab-pane fade show active" id="tab-consulta" role="tabpanel" aria-labelledby="tab-consulta-tab">
                <div class="p-3">
                    
<div class="consulta-container" id="consultaContainer" data-table-id="120">
    <!-- Barra de ferramentas -->
    <div class="row mb-3">
        <div class="col-md-4">
            <label class="form-label fw-bold">Consulta</label>
            <select id="consultaSelect" class="form-select">
                    <option value="120000" data-busc="COTR000-Padr&#xE3;o">
                        COTR000-Padr&#xE3;o
                    </option>
                    <option value="120000" data-busc="COTR000-Padr&#xE3;o">
                        COTR000-Padr&#xE3;o
                    </option>
            </select>
        </div>
        <div class="col-md-8 d-flex align-items-end">
            <button type="button" class="btn btn-outline-secondary me-2" id="btnRefresh" title="Atualizar">
                <i class="bi bi-arrow-clockwise"></i> Atualizar
            </button>
        </div>
    </div>

    <!-- Filtros -->
    <div class="card mb-3">
        <div class="card-body py-2">
            <div class="row g-2 align-items-center" id="filterRow">
                <div class="col-md-3">
                    <select id="filterField" class="form-select form-select-sm">
                        <option value="">-- Campo --</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <select id="filterCondition" class="form-select form-select-sm">
                        <option value="startswith">Iniciado por</option>
                        <option value="contains" selected>Contém</option>
                        <option value="equals">Igual a</option>
                        <option value="notequals">Diferente de</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <input type="text" id="filterValue" class="form-control form-control-sm" placeholder="Localiza...">
                </div>
                <div class="col-md-4 d-flex gap-2">
                    <button type="button" class="btn btn-primary btn-sm" id="btnAddFilter">
                        <i class="bi bi-funnel"></i> Filtrar
                    </button>
                    <button type="button" class="btn btn-outline-secondary btn-sm" id="btnClearFilters">
                        <i class="bi bi-x-circle"></i> Limpar
                    </button>
                </div>
            </div>
            <!-- Tags de filtros ativos -->
            <div id="activeFilters" class="mt-2"></div>
        </div>
    </div>

    <!-- Grid -->
    <div class="table-responsive">
        <table class="table table-striped table-hover table-sm" id="consultaGrid">
            <thead class="table-dark">
                <tr id="gridHeader"></tr>
            </thead>
            <tbody id="gridBody">
                <tr>
                    <td colspan="10" class="text-center text-muted py-4">
                        Selecione uma consulta para carregar os dados...
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Paginacao -->
    <div class="d-flex justify-content-between align-items-center mt-2">
        <div class="text-muted" id="gridInfo">
            Mostrando 0 registros
        </div>
        <nav>
            <ul class="pagination pagination-sm mb-0" id="gridPagination">
            </ul>
        </nav>
    </div>

    <hr class="my-3">

    <!-- Botoes CRUD -->
    <div class="d-flex gap-2">
            <button type="button" class="btn btn-success" id="btnIncluir">
                <i class="bi bi-plus-circle"></i> Incluir
            </button>
            <button type="button" class="btn btn-primary" id="btnAlterar" disabled>
                <i class="bi bi-pencil"></i> Alterar
            </button>
            <button type="button" class="btn btn-danger" id="btnExcluir" disabled>
                <i class="bi bi-trash"></i> Excluir
            </button>
    </div>
</div>

                </div>
            </div>

            <!-- Conteudo Tab Dados -->
            <div class="tab-pane fade" id="tab-dados" role="tabpanel" aria-labelledby="tab-dados-tab">
                <div class="p-3">
                    
<form id="dynamicForm" class="needs-validation" novalidate>
    <input type="hidden" id="editingRecordId" name="editingRecordId" value="" />


            <fieldset class="bevel-group">
                <div class="bevel-content">


    <div class="field-row field-row-multi">


        <div class="field-wrapper " style="flex: 150 1 150px; min-width: 120px;">
                <label for="field_120002" class="form-label">
                    N&#xFA;mero Contrato
                        <span class="text-danger">*</span>
                </label>
            <input type="number"
                   class="form-control"
                   id="field_120002"
                   name="NUMECONT"
                   title="N&#xFA;mero do Contrato"
                   placeholder="N&#xFA;mero do Contrato"
                   min="0"                   max="0"                   step="1"
                   required
                    />
        </div>


        <div class="field-wrapper " style="flex: 310 1 310px; min-width: 120px;">
                <label for="field_120003" class="form-label">
                    Tipo
                </label>
            <select class="form-select"
                    id="field_120003"
                    name="TIPOCONT"
                    title="Tipo"
                    
                    >
                <option value="">Selecione...</option>
                        <option value="E">Entrada</option>
                        <option value="S">Sa&#xED;da</option>
            </select>
        </div>


        <div class="field-wrapper " style="flex: 0 0 auto;">
            <div class="form-check">
                <input type="hidden" name="ATIVCONT" value="0" />
                <input type="checkbox"
                       class="form-check-input"
                       id="field_120004"
                       name="ATIVCONT"
                       value="1"
                       title="Ativo"
                       checked
                        />
                    <label for="field_120004" class="form-check-label">
                        Ativo
                    </label>
            </div>
        </div>
    </div>


    <div class="field-row field-row-multi">


        <div class="field-wrapper " style="flex: 150 1 150px; min-width: 120px;">
                <label for="field_120005" class="form-label">
                    Data
                </label>
            <input type="date"
                   class="form-control"
                   id="field_120005"
                   name="DATACONT"
                   title="Data"
                   
                    />
        </div>


        <div class="field-wrapper  " style="flex: 310 1 310px; min-width: 120px;">
                <label for="field_120006" class="form-label">
                    Pessoa
                        <span class="text-danger">*</span>
                </label>
            <div class="input-group">
                <input type="text"
                       class="form-control "
                       id="field_120006"
                       name="CODIPESS"
                       title="Pessoa"
                       placeholder="Pessoa"
                       required
                        />
                <button type="button"
                        class="btn btn-outline-secondary btn-lookup"
                        title="Pesquisar"
                        >
                    <i class="bi bi-search"></i>
                </button>
            </div>
        </div>
    </div>
                </div>
            </fieldset>
            <fieldset class="bevel-group">
                <div class="bevel-content">


    <div class="field-row field-row-multi">


        <div class="field-wrapper " style="flex: 150 1 150px; min-width: 120px;">
                <label for="field_120008" class="form-label">
                    Tipo Contrato
                </label>
            <select class="form-select"
                    id="field_120008"
                    name="TIP_CONT"
                    title="Tipo Contrato"
                    
                    >
                <option value="">Selecione...</option>
                        <option value="0">Per&#xED;odo</option>
                        <option value="1">Quantidade</option>
            </select>
        </div>


        <div class="field-wrapper " style="flex: 150 1 150px; min-width: 120px;">
                <label for="field_120009" class="form-label">
                    Quantidade Total
                </label>
            <input type="number"
                   class="form-control"
                   id="field_120009"
                   name="QTTOCONT"
                   title="Quantidade Total"
                   placeholder="Quantidade Total"
                   min="0"                   max="0"                   step="1"
                   
                    />
        </div>


        <div class="field-wrapper " style="flex: 150 1 150px; min-width: 120px;">
                <label for="field_120010" class="form-label">
                    Data In&#xED;cio
                </label>
            <input type="date"
                   class="form-control"
                   id="field_120010"
                   name="DAINCONT"
                   title="Data de In&#xED;cio do Contrato"
                   
                    />
        </div>


        <div class="field-wrapper " style="flex: 150 1 150px; min-width: 120px;">
                <label for="field_120011" class="form-label">
                    Data Final
                </label>
            <input type="date"
                   class="form-control"
                   id="field_120011"
                   name="DAFICONT"
                   title="Data de Fim do Contrato"
                   
                    />
        </div>


        <div class="field-wrapper " style="flex: 150 1 150px; min-width: 120px;">
                <label for="field_120012" class="form-label">
                    % Toler&#xE2;ncia
                </label>
            <input type="number"
                   class="form-control"
                   id="field_120012"
                   name="PETOCONT"
                   title="% Toler&#xE2;ncia"
                   placeholder="% Toler&#xE2;ncia"
                   min="0"                   max="0"                   step="1"
                   
                    />
        </div>
    </div>


    <div class="field-row field-row-multi">


        <div class="field-wrapper " style="flex: 310 1 310px; min-width: 120px;">
                <label for="field_120013" class="form-label">
                    Contrato Fornecedor
                </label>
            <input type="text"
                   class="form-control"
                   id="field_120013"
                   name="NUMFCONT"
                   title="Contrato Fornecedor"
                   placeholder="Contrato Fornecedor"
                   
                   
                   data-mask="" />
        </div>


        <div class="field-wrapper " style="flex: 150 1 150px; min-width: 120px;">
                <label for="field_120014" class="form-label">
                    Tipo do Frete
                </label>
            <select class="form-select"
                    id="field_120014"
                    name="FRTPCONT"
                    title="Tipo do Frete"
                    
                    >
                <option value="">Selecione...</option>
                        <option value="CIF">CIF</option>
                        <option value="FOB">FOB</option>
            </select>
        </div>


        <div class="field-wrapper " style="flex: 150 1 150px; min-width: 120px;">
                <label for="field_120015" class="form-label">
                    Valor Frete
                </label>
            <input type="number"
                   class="form-control"
                   id="field_120015"
                   name="XFRECONT"
                   title="Valor Frete"
                   placeholder="Valor Frete"
                   min="0"                   max="0"                   step="0.0001"
                   
                    />
        </div>
    </div>


    <div class="field-row field-row-single">
        

        <div class="field-wrapper " style="flex: 1 1 150px;">
            <div class="form-check">
                <input type="hidden" name="UNFXCONT" value="0" />
                <input type="checkbox"
                       class="form-check-input"
                       id="field_120016"
                       name="UNFXCONT"
                       value="1"
                       title="Valor Unit&#xE1;rio Fixo"
                       
                        />
                    <label for="field_120016" class="form-check-label">
                        Valor Unit&#xE1;rio Fixo
                    </label>
            </div>
        </div>

    </div>


    <div class="field-row field-row-single">
        

        <div class="field-wrapper field-wrapper-full mb-3 ">
                <label for="field_120017" class="form-label">
                    Observa&#xE7;&#xE3;o
                </label>
            <textarea class="form-control"
                      id="field_120017"
                      name="OBS_CONT"
                      title="Observa&#xE7;&#xE3;o"
                      placeholder="Observa&#xE7;&#xE3;o"
                      rows="6"
                      
                      ></textarea>
        </div>

    </div>
                </div>
            </fieldset>

    <hr class="my-4" />

    <div class="d-flex gap-2">
        <button type="submit" class="btn btn-primary">
            <i class="bi bi-check-lg"></i> Salvar
        </button>
        <button type="button" class="btn btn-outline-secondary" id="btnCancelar">
            <i class="bi bi-x-lg"></i> Cancelar
        </button>
    </div>
</form>

<script>
    document.getElementById('btnCancelar')?.addEventListener('click', function() {
        // Volta para a tab Consulta
        document.getElementById('tab-consulta-tab')?.click();
    });
</script>

                </div>
            </div>

                    <div class="tab-pane fade" id="tab-mov-125" role="tabpanel" aria-labelledby="tab-mov-125-tab">
                        <div class="p-3">
                            
<div class="movement-container">
    <!-- Campos do movimento organizados por linhas -->
        <div class="movement-fields mb-3">
                    <div class="field-row-multi mb-2">


        <div class="field-wrapper field-calc field-readonly" style="flex: 150 1 150px; min-width: 120px;">
                <label for="field_120019" class="form-label">
                    Qtde. Total
                </label>
            <input type="number"
                   class="form-control form-control-calc"
                   id="field_120019"
                   name="TOQTMVCT"
                   title="Quantidade Total"
                   min="0"                   max="0"                   readonly
                   data-calc="true" />
        </div>


        <div class="field-wrapper field-calc field-readonly" style="flex: 150 1 150px; min-width: 120px;">
                <label for="field_120020" class="form-label">
                    Valor Total
                </label>
            <input type="number"
                   class="form-control form-control-calc"
                   id="field_120020"
                   name="TOVLMVCT"
                   title="Valor Total"
                   min="0"                   max="0"                   readonly
                   data-calc="true" />
        </div>
                    </div>
        </div>

    <!-- Grid de itens (placeholder visual) -->
    <div class="movement-grid-container">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <h6 class="mb-0">Itens</h6>
            <div class="btn-group">
                <button type="button" class="btn btn-outline-primary btn-sm" disabled title="Funcionalidade em desenvolvimento">
                    <i class="bi bi-plus-lg"></i> Envia
                </button>
                <button type="button" class="btn btn-outline-danger btn-sm" disabled title="Funcionalidade em desenvolvimento">
                    <i class="bi bi-trash"></i> Remove
                </button>
            </div>
        </div>

        <div class="table-responsive">
            <table class="table table-bordered table-striped movement-grid">
                <thead class="table-light">
                    <tr>
                                <th title="Quantidade Total">Qtde. Total</th>
                                <th title="Valor Total">Valor Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="text-center text-muted">
                        <td colspan="2">
                            <div class="py-4">
                                <i class="bi bi-inbox fs-1 d-block mb-2 text-secondary"></i>
                                <span>Nenhum item cadastrado</span>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

                        </div>
                    </div>
        </div>
</div>


        </main>
    </div>

    <footer b-k2ctk0jt16 class="border-top footer text-muted">
        <div b-k2ctk0jt16 class="container">
            &copy; 2025 - SagPoc.Web - <a href="/Home/Privacy">Privacy</a>
        </div>
    </footer>
    <script src="/lib/jquery/dist/jquery.min.js"></script>
    <script src="/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/site.js?v=hRQyftXiu1lLX2P9Ly9xa4gHJgLeR1uGN5qegUobtGo"></script>
    
    <script src="/js/consulta-grid.js"></script>
    <script>
        // Validacao Bootstrap
        (function () {
            'use strict'
            var forms = document.querySelectorAll('.needs-validation')
            Array.prototype.slice.call(forms).forEach(function (form) {
                form.addEventListener('submit', function (event) {
                    event.preventDefault();
                    if (!form.checkValidity()) {
                        event.stopPropagation();
                    } else {
                        // Salvar via AJAX
                        saveForm(form);
                    }
                    form.classList.add('was-validated');
                }, false)
            })
        })()

        // Funcao para salvar formulario
        async function saveForm(form) {
            const formData = new FormData(form);
            const fields = {};
            formData.forEach((value, key) => {
                fields[key] = value;
            });

            // Garantir que checkboxes nao marcados enviem valor 0
            form.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                if (!cb.checked && cb.name) {
                    fields[cb.name] = '0';
                }
            });

            const tableId = 120;
            const recordId = document.getElementById('editingRecordId')?.value || null;

            try {
                const response = await fetch('/Form/SaveRecord', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        tableId: tableId,
                        recordId: recordId ? parseInt(recordId) : null,
                        fields: fields
                    })
                });

                const result = await response.json();
                if (result.success) {
                    alert(result.message);
                    // Volta para tab Consulta e recarrega
                    if (window.consultaGrid) {
                        document.getElementById('tab-consulta-tab')?.click();
                        window.consultaGrid.loadData();
                    }
                } else {
                    alert('Erro: ' + result.message);
                }
            } catch (error) {
                console.error('Erro ao salvar:', error);
                alert('Erro ao salvar registro');
            }
        }
    </script>

</body>
</html>
